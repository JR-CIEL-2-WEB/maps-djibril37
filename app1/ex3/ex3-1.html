<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>JRostand stade reperes</title>
    <link rel="stylesheet" type="text/css" href="./style.css" />
</head>

<body>

    <h1>JRostand Reperes Stade</h1>
    <hr>
    <div id="map">...</div>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA7Y32T_PJHZxYcK3BJYJFNwSl6cuvLXpo&callback=loadDoc&v=weekly" defer></script>
    <script>

        var markers;
        var map;

        // when page is API google maps is complete, process for the map!
        // Fetch au lieu de Ajax
        function loadDoc() {
            fetch("markersJrostand.json")
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Erreur réseau: ' + response.status);
                    }
                    return response.json();
                })
                .then(markersData => {
                    markers = markersData;
                    
                    // TODO4 : Affichage des coordonnées dans la console
                    for(let i = 0; i < markers.length; i++){
                        let marker = markers[i];
                        for(key in marker){
                            console.log(key + ":" + marker[key]);
                        }
                        console.log("____________");
                    }

                    // Initialisation de la carte
                    initMap();
                })
                .catch(error => {
                    console.error("Erreur lors du chargement JSON:", error);
                    initMap(); // Initialiser quand même la carte
                });
        };

        function initMap() {
            var options = {
                center: new google.maps.LatLng(48.95930033308523, 2.5477890651742516),
                zoom: 15,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };

            map = new google.maps.Map(document.getElementById("map"), options);

            // Créer un tableau pour stocker les positions des marqueurs
            var positions = [];

            // Afficher les markers
            for (let i = 0; i < markers.length; i++) {
                let latlng = new google.maps.LatLng(markers[i].lat, markers[i].lng);
                positions.push(latlng);
                
                new google.maps.Marker({
                    position: latlng,
                    map: map,
                    title: "Point " + (i + 1)
                });
            }

            // Ajouter les polylines entre les markers
            if (positions.length > 1) {
                var polyline = new google.maps.Polyline({
                    path: positions,
                    geodesic: true,
                    strokeColor: "#FF0000",
                    strokeOpacity: 1.0,
                    strokeWeight: 2,
                    map: map
                });
            }
        }

    </script>

</body>

</html>